{
  "title": "GitLab CI Pipelines & Jobs",
  "description": "Dashboard to monitor GitLab CI pipelines and jobs exported by mvisonneau/gitlab-ci-pipelines-exporter. Includes job duration, queued time, status, artifact size, and pipeline health.",
  "widgets": [
    {
      "id": 3878911908204617,
      "definition": {
        "title": "Gitlab Exporter Overview",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 2766281300076400,
            "definition": {
              "title": "Pipeline Success Rate (Weekly)",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "time": {
                "type": "live",
                "unit": "month",
                "value": 2
              },
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "100 * (query1 / query2)"
                    }
                  ],
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "sum:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_status{status:success, project:$project.value, ref:$ref.value}.rollup(sum, weekly)"
                    },
                    {
                      "name": "query2",
                      "data_source": "metrics",
                      "query": "sum:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_status{project:$project.value ,ref:$ref.value}.rollup(sum, weekly)"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 3
            }
          },
          {
            "id": 3933059575579824,
            "definition": {
              "title": "Number of Queued Tasks",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gcpe_currently_queued_tasks_count{*}"
                    }
                  ],
                  "response_format": "scalar",
                  "formulas": [
                    {
                      "formula": "query1"
                    }
                  ]
                }
              ],
              "autoscale": true,
              "precision": 0
            },
            "layout": {
              "x": 0,
              "y": 3,
              "width": 4,
              "height": 3
            }
          },
          {
            "id": 736436982025584,
            "definition": {
              "title": "Number of Refs Exported",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gcpe_refs_count{*}"
                    }
                  ],
                  "response_format": "scalar",
                  "formulas": [
                    {
                      "formula": "query1"
                    }
                  ]
                }
              ],
              "precision": 0
            },
            "layout": {
              "x": 4,
              "y": 3,
              "width": 4,
              "height": 3
            }
          },
          {
            "id": 6944121047635519,
            "definition": {
              "title": "Number of Projects Exported",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gcpe_projects_count{*}"
                    }
                  ],
                  "response_format": "scalar",
                  "formulas": [
                    {
                      "formula": "query1"
                    }
                  ]
                }
              ],
              "precision": 0
            },
            "layout": {
              "x": 8,
              "y": 3,
              "width": 4,
              "height": 3
            }
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 0,
        "width": 12,
        "height": 7
      }
    },
    {
      "id": 4073767889389905,
      "definition": {
        "title": "Pipelines Activity",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 6536217818749217,
            "definition": {
              "title": "Average Pipeline Duration (seconds)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "type": "timeseries",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_duration_seconds{project:$project.value, ref:$ref.value} by {project,ref}"
                    }
                  ],
                  "response_format": "timeseries",
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": {
              "x": 0,
              "y": 0,
              "width": 6,
              "height": 3
            }
          },
          {
            "id": 4151789910268797,
            "definition": {
              "title": "Top 10 Longest Pipelines (Project, Ref)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_duration_seconds{project:$project.value, ref:$ref.value} by {project,ref}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 1200,
                      "palette": "white_on_red"
                    },
                    {
                      "comparator": ">",
                      "value": 600,
                      "palette": "white_on_yellow"
                    },
                    {
                      "comparator": "<=",
                      "value": 600,
                      "palette": "white_on_green"
                    }
                  ],
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "sort": {
                    "count": 10,
                    "order_by": [
                      {
                        "type": "formula",
                        "index": 0,
                        "order": "desc"
                      }
                    ]
                  }
                }
              ],
              "style": {}
            },
            "layout": {
              "x": 6,
              "y": 0,
              "width": 6,
              "height": 3
            }
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 7,
        "width": 12,
        "height": 4
      }
    },
    {
      "id": 7672399686715141,
      "definition": {
        "title": "Jobs Activity",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 347444440844771,
            "definition": {
              "title": "Failed Jobs by Project and Stage",
              "title_size": "16",
              "title_align": "left",
              "type": "query_table",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_status{status:failed, project:$project.value, stage:$stage.value} by {job_name,project,stage}"
                    }
                  ],
                  "response_format": "scalar",
                  "sort": {
                    "count": 500,
                    "order_by": [
                      {
                        "type": "formula",
                        "index": 0,
                        "order": "desc"
                      }
                    ]
                  },
                  "formulas": [
                    {
                      "alias": "Number Of Failures",
                      "number_format": {
                        "precision": 1
                      },
                      "conditional_formats": [
                        {
                          "comparator": ">=",
                          "value": 10,
                          "palette": "white_on_red"
                        }
                      ],
                      "formula": "query1"
                    }
                  ]
                }
              ]
            },
            "layout": {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 3
            }
          },
          {
            "id": 1125771102682596,
            "definition": {
              "title": "Average Job Duration (seconds)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "type": "timeseries",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_duration_seconds{project:$project.value, ref:$ref.value, stage:$stage.value} by {project,stage,job_name,ref}"
                    }
                  ],
                  "response_format": "timeseries",
                  "formulas": [
                    {
                      "formula": "query1",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      }
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": {
              "x": 0,
              "y": 3,
              "width": 6,
              "height": 3
            }
          },
          {
            "id": 8826330684358435,
            "definition": {
              "title": "Job Run Count (Last 24h)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "time": {
                "type": "live",
                "unit": "day",
                "value": 1
              },
              "type": "timeseries",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_run_count.count{project:$project.value, ref:$ref.value, stage:$stage.value} by {project,job_name,ref,stage}.rollup(sum, 3600).as_count()"
                    }
                  ],
                  "response_format": "timeseries",
                  "formulas": [
                    {
                      "formula": "query1"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": {
              "x": 6,
              "y": 3,
              "width": 6,
              "height": 3
            }
          },
          {
            "id": 6186316321030207,
            "definition": {
              "title": "Artifact Size (MB) per Job",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "type": "timeseries",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_artifact_size_bytes{project:$project.value, ref:$ref.value ,stage:$stage.value} by {project,job_name,ref,stage}"
                    }
                  ],
                  "response_format": "timeseries",
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "mebibyte"
                        }
                      },
                      "formula": "(query1) / 1048576"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "area"
                }
              ]
            },
            "layout": {
              "x": 0,
              "y": 6,
              "width": 6,
              "height": 3
            }
          },
          {
            "id": 1097156518477448,
            "definition": {
              "title": "Average Job Queue Time (seconds)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": [
                "avg",
                "min",
                "max",
                "value",
                "sum"
              ],
              "type": "timeseries",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_queued_duration_seconds{project:$project.value, stage:$stage.value, ref:$ref.value} by {project,stage,ref,job_name}"
                    }
                  ],
                  "response_format": "timeseries",
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": {
              "x": 6,
              "y": 6,
              "width": 6,
              "height": 3
            }
          },
          {
            "id": 2246737241744129,
            "definition": {
              "title": "Top 10 Longest Jobs (Project, Job Name, Ref, Stage)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_duration_seconds{project:$project.value, ref:$ref.value, stage:$stage.value} by {project,job_name,ref,stage}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 600,
                      "palette": "white_on_red"
                    },
                    {
                      "comparator": ">",
                      "value": 300,
                      "palette": "white_on_yellow"
                    },
                    {
                      "comparator": "<=",
                      "value": 300,
                      "palette": "white_on_green"
                    }
                  ],
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "sort": {
                    "count": 10,
                    "order_by": [
                      {
                        "type": "formula",
                        "index": 0,
                        "order": "desc"
                      }
                    ]
                  }
                }
              ],
              "style": {}
            },
            "layout": {
              "x": 0,
              "y": 9,
              "width": 6,
              "height": 3
            }
          },
          {
            "id": 3408721054583966,
            "definition": {
              "title": "Top 10 Jobs with Longest Queue Times (Project, Job Name, Ref, Stage)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "max:gitlab_ci_pipelines_exporter.gitlab_ci_pipeline_job_queued_duration_seconds{project:$project.value, ref:$ref.value, stage:$stage.value} by {project,job_name,ref,stage}"
                    }
                  ],
                  "response_format": "scalar",
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "sort": {
                    "count": 10,
                    "order_by": [
                      {
                        "type": "formula",
                        "index": 0,
                        "order": "desc"
                      }
                    ]
                  }
                }
              ],
              "style": {}
            },
            "layout": {
              "x": 6,
              "y": 9,
              "width": 6,
              "height": 3
            }
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 11,
        "width": 12,
        "height": 13,
        "is_column_break": true
      }
    }
  ],
  "template_variables": [
    {
      "name": "project",
      "available_values": [],
      "default": "*"
    },
    {
      "name": "ref",
      "available_values": [],
      "default": "*"
    },
    {
      "name": "stage",
      "available_values": [],
      "default": "*"
    }
  ],
  "layout_type": "ordered",
  "notify_list": [],
  "reflow_type": "fixed",
  "pause_auto_refresh": false
}